# Projekttagebuch – 22.07.2025 – Vin

## Heutige Hauptaufgabe(n) – Was war das Ziel heute?

- CI/CD für das Loop-It-Projekt wieder funktionsfähig machen
- Terraform-Backend (S3 + OIDC) aufräumen und reparieren
- Kompatibilität mit aktueller Terraform-Version sicherstellen
- **Monitoring-Stack für EKS via Terraform implementieren**

---

## Fortschritt & Ergebnisse – Was habe ich konkret geschafft?

- Upgrade auf Terraform 1.12.2 durchgeführt (via Chocolatey)
- Fehlerhafte State- und Lock-Dateien im S3-Backend manuell entfernt
- Neues S3-Backend erstellt und korrekt mit `terraform init -reconfigure` initialisiert
- OIDC-Setup validiert: bestehender GitHub-OIDC-Provider & IAM-Role korrekt erkannt
- Bestehende `loop-it-github-actions-role` erfolgreich in Terraform importiert
- Backend + Role wieder vollständig unter Terraform-Kontrolle gebracht
- **Modulares Monitoring-System entwickelt: 6 Terraform-Dateien (prometheus.tf, grafana.tf, loki.tf, ingress.tf, variables.tf, outputs.tf) statt einer 1100+ Zeilen Monolith-Datei**
- **Vollständige Infrastructure-as-Code Lösung: Eliminierung manueller NGINX Ingress Installation und EKS Access-Konfiguration**
- **Terraform Helm Provider Integration für automatische NGINX Ingress Deployment**

---

## Herausforderungen & Blockaden – Wo hing ich fest?

- Terraform konnte die alte `.terraform.tfstate.lock.info` mehrfach nicht loslassen – trotz Löschen blieb die Lock-Info bestehen
- Alte Ressourcen wie OIDC-Provider und IAM-Role führten zu `EntityAlreadyExists` Fehlern
- Import der IAM-Rolle schlug fehl, da die ARN statt des Rollennamens verwendet wurde (Terraform erwartet `role-name`, nicht `arn:`)
- **Monitoring-Architektur: Balancing zwischen Modularität und Komplexität – 1100+ Zeilen Code in einer Datei ist nicht wartbar**
- **Provider Lock File Konflikte zwischen verschiedenen Terraform-Runs beim Hinzufügen neuer Provider**

---

## Was ich heute gelernt habe – Eine kleine, konkrete Erkenntnis oder neues Wissen:

- Terraform-Ressourcen wie `aws_iam_role` müssen mit dem **Rollennamen**, nicht mit der **ARN**, importiert werden
- Manuelles Entfernen von Lockfiles in S3 kann notwendig sein, wenn ein Lock "hängt"
- **Terraform Best Practice: Maximal 200-300 Zeilen pro Datei für bessere Wartbarkeit und Team-Kollaboration**
- **Modulare Terraform-Struktur reduziert Merge-Konflikte und verbessert Code-Organisation erheblich**
- **null_resource mit Docker-Commands ermöglicht Container-Build-Automatisierung direkt in Terraform**

---

## Plan für morgen – Was ist der nächste logische Schritt?

- **Monitoring-Stack Deployment testen: `terraform apply` mit enableSmonitoring=true ausführen**
- **Load-Testing Scripts für Live-Demo entwickeln (Artillery gegen EKS LoadBalancer)**
- GitHub Actions Workflow `terraform-ci.yaml` erneut testen und debuggen
- Falls nötig, OIDC-Rollenzugriff in GitHub `main` und `feature/gitops-setup` Branch testen
- **Demo-Vorbereitung: Grafana Dashboards für Backend-Performance und Prometheus-Metriken erstellen**
- Optional: Doku-Update für das komplette EKS + Monitoring Setup